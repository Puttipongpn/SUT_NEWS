<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"> -->

</head>

<body>
    <%- include('../header') %>
        <%- include('../nav') %>
            <form method="post" action="/addnews/<%= users[0].id %>" id="news"
                class="d-flex justify-content-between align-items-center">
                <div class="container">
                    <div class=" row gutters">
                        <div class="col-12 col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="account-settings">
                                        <div class="user-profile">
                                            <div class="user-avatar">
                                                <% if (users[0].profile_image) { %>
                                                    <img id="profilePicture-s"
                                                        class="img-account-profile rounded-circle mb-2" <% const
                                                        imagePath=users[0].profile_image.substring(7); %>
                                                    src="<%= imagePath %>" alt="">
                                                        <% } else { %>
                                                            <img id="profilePicture-s"
                                                                class="img-account-profile rounded-circle mb-2"
                                                                src="http://bootdey.com/img/Content/avatar/avatar1.png"
                                                                alt="">
                                                            <% } %>
                                            </div>
                                            <h5 class="user-name">
                                                <%= user_name %>
                                            </h5>
                                            <h6 class="user-email"><%- email %></h6>
                                        </div>
                                        <div class="about">
                                            <h5 class="mb-2 text-primary">About</h5>
                                            <p> <%- description %> </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="account-settings">
                                        <div class="form-group">
                                            <div>
                                                <label for="tags">Tags Select</label>
                                            </div>
                                            <div>
                                                <select class="form-select-ad form-select-lg" id="tags"
                                                     aria-label="Default select example" >
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <table id="selectedTagsTable">
                                    <thead>
                                        <tr>
                                            <th>tags id</th>
                                            <th>name</th>
                                            <th>delect</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="col-12 col-md-9">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row gutters">
                                        <div class="col-12">
                                            <h6 class="mb-3 text-primary">ADD NEWS</h6>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="form-group">
                                                <div>
                                                    <label for="news_type_select">NEWS TYPE</label>
                                                </div>
                                                <div>
                                                    <select class="form-select-ad form-select-lg" id="news_type_select"
                                                        name="news_type_id" aria-label="Default select example">
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="">
                                                <div>
                                                    <label for="">NEWS TOPIC</label>
                                                </div>
                                                <div>
                                                    <select class="form-select-ad form-select-sm" id="news_topic_select"
                                                        name="topic_id" placeholder="Enter email ID"
                                                        aria-label="Default select example">
                                                        <!-- <option selected>Open this select menu</option>
                                                    <option value="1">One</option>
                                                    <option value="2">Two</option>
                                                    <option value="3">Three</option> -->
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6" style="padding-top: 20px;">
                                            <div class="">
                                                <label for="title">Title</label>
                                                <input type="text" class="form-control form-control-lg" id="title"
                                                    name="title" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6" style="padding-top: 20px;">
                                        </div>
                                        <div class="col-12 col-md-6" style="padding-top: 20px;">
                                            <div>
                                                <div>
                                                    <label for="street">Headline Picture</label>
                                                </div>
                                                <div>
                                                    <img id="img"
                                                        src="https://kodfun.github.io/Reels/ImagePreview/choose.png"
                                                        height="200">
                                                </div>
                                                <div style="padding-top: 10px;">
                                                    <input id="input" type="file" class="btn btn-primary"
                                                        style="height: 38px; padding-top:4px">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12" style="padding-top: 20px;">
                                            <div>
                                                <label for="">ADD Picture or Video</label>
                                            </div>
                                            <div style="padding-top: 5px;">
                                                <button class="btn btn-warning" style="margin-right: 5px;"
                                                    onclick="addMedia()"type="button">เพิ่มสื่อ</button>
                                                <input class="btn btn-primary" style="height: 38px; padding-top:3px"
                                                    type="file" id="mediaFile">
                                            </div>
                                            <div style="padding-top: 10px;">
                                                <table id="mediaTable">
                                                    <thead>
                                                        <tr>
                                                            <th>ชื่อภาพ</th>
                                                            <th>ประเภท</th>
                                                            <th>ดูรูปภาพ/วิดิโอ</th>
                                                            <th>ลบ</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6" style="padding-top: 20px;">
                                            <div class="">
                                                <label for="Intro_para">Introl</label>
                                                <input type="text" class="form-control form-control-lg" id="Intro_para"
                                                    name="Intro_para" placeholder="">
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6" style="padding-top: 20px;">
                                            <div class="">
                                                <label for="welding_para">Welding</label>
                                                <input class="form-control form-control-lg" id="welding_para"
                                                    name="welding_para" placeholder="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row gutters">
                                        <div class="col-12" style="padding-top: 10px;">
                                            <label for="main_para">Main paragrap</label>
                                            <textarea class="form-control" id="main_para" name="main_para"
                                                rows="3"></textarea>
                                        </div>
                                        <div class="col-12">
                                            <label for="end_para">End paragrap</label>
                                            <textarea class="form-control" id="end_para" name="end_para"
                                                rows="3"></textarea>
                                        </div>
                                    </div>

                                    <div class="row gutters">
                                        <div class="col-12" style="padding-top: 20px;">
                                            <div class="d-flex justify-content-between">
                                                <button type="" id="submit" name="submit"
                                                    class="btn btn-danger">Cancel</button>
                                                <button type="submit" class="btn btn-primary">Sent</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </form>
            <style>
                .card {
                    background: #030c29;
                    -webkit-border-radius: 5px;
                    -moz-border-radius: 5px;
                    border-radius: 5px;
                    border: 0;
                    margin-bottom: 1rem;
                    margin-top: 40px;
                }

                body {
                    color: #bcd0f7;
                    background: #1A233A;
                }

                table {
                    border-collapse: collapse;
                }

                table,
                th,
                td {
                    border: 1px solid black;
                }

                th,
                td {
                    padding: 10px;
                }

                .image-button {
                    background-color: transparent;
                    border: none;
                    cursor: pointer;
                    text-decoration: underline;
                    color: blue;
                }

                .modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.7);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999;
                }

                .modal-image {
                    max-width: 80%;
                    max-height: 80%;
                }

                .form-control {
                    border: 1px solid #596280;
                    -webkit-border-radius: 2px;
                    -moz-border-radius: 2px;
                    border-radius: 2px;
                    font-size: .825rem;
                    background: #1A233A;
                    color: #bcd0f7;
                }
            </style>
            <%- include('../footer') %>
</body>
<script>
    let img = document.getElementById('img');
    let input = document.getElementById('input');
    input.onchange = (e) => {
        if (input.files[0])
            img.src = URL.createObjectURL(input.files[0]);
    };
    function addMedia() {
        var fileInput = document.getElementById("mediaFile");
        var file = fileInput.files[0];

        if (file) {
            var mediaTable = document.getElementById("mediaTable");
            var tbody = mediaTable.getElementsByTagName("tbody")[0];

            // เพิ่มข้อมูลในตาราง
            var newRow = tbody.insertRow();
            var nameCell = newRow.insertCell();
            nameCell.textContent = file.name;

            var typeCell = newRow.insertCell();
            typeCell.textContent = file.type.startsWith("image/") ? "ภาพ" : "วิดิโอ";

            var viewButtonCell = newRow.insertCell();
            var viewButton = document.createElement("button");
            viewButton.className = "view-button";
            viewButton.type = "button"
            var viewIcon = document.createElement("i");
            viewIcon.className = "bi bi-eye";
            viewButton.appendChild(viewIcon);
            viewButton.onclick = function () {
                viewMedia(file);
            };
            viewButtonCell.appendChild(viewButton);

            var deleteButtonCell = newRow.insertCell();
            var deleteButton = document.createElement("button");
            deleteButton.className = "delete-button";
            deleteButton.onclick = function () {
                deleteMedia(newRow);
            };
            var deleteIcon = document.createElement("i");
            deleteIcon.className = "bi bi-archive"; // หรือใช้คลาสไอคอนของ Font Awesome ที่คุณต้องการ
            deleteButton.appendChild(deleteIcon);
            deleteButtonCell.appendChild(deleteButton);
        }
    }

    function viewMedia(file) {
        // ตรวจสอบว่าเป็นไฟล์รูปภาพหรือวิดิโอ
        if (file.type.startsWith("image/")) {
            // สร้างตัวอ้างอิงให้กับรูปภาพในการดู
            var image = new Image();
            image.src = URL.createObjectURL(file);

            // สร้างตัวกล่องโมดัลสำหรับแสดงรูปภาพ
            var modal = document.createElement("div");
            modal.className = "modal";
            modal.onclick = function () {
                document.body.removeChild(modal);
            };

            // สร้างตัวรูปภาพและเพิ่มลงในโมดัล
            var imageView = document.createElement("img");
            imageView.src = image.src;
            imageView.className = "modal-image";
            imageView.alt = file.name;
            modal.appendChild(imageView);

            // เพิ่มโมดัลลงในเอกสาร
            document.body.appendChild(modal);
        } else if (file.type.startsWith("video/")) {
            // สร้างตัวเล่นวิดิโอ
            var videoPlayer = document.createElement("video");
            videoPlayer.src = URL.createObjectURL(file);
            videoPlayer.controls = true;
            videoPlayer.autoplay = true;

            // สร้างตัวกล่องโมดัลสำหรับแสดงวิดิโอ
            var modal = document.createElement("div");
            modal.className = "modal";
            modal.onclick = function () {
                document.body.removeChild(modal);
            };

            // เพิ่มวิดิโอเข้าไปในโมดัล
            modal.appendChild(videoPlayer);

            // เพิ่มโมดัลลงในเอกสาร
            document.body.appendChild(modal);
        }
    }
    function deleteMedia(row) {
        var mediaTable = document.getElementById("mediaTable");
        var tbody = mediaTable.getElementsByTagName("tbody")[0];

        tbody.removeChild(row);
    }
</script>
<script> //ดึงข้อมูลเข้า combobox
    // ในส่วนที่เรียกใช้หน้า HTML ที่มีฟอร์ม
    const dataSelect_news_type = document.getElementById('news_type_select');
    const defaultOption2 = document.createElement('option');
    defaultOption2.value = ''; // กำหนดค่าว่างให้เป็นค่าเริ่มต้น
    defaultOption2.textContent = 'กรุณาเลือก';
    dataSelect_news_type.appendChild(defaultOption2);
    // ดึงข้อมูลจากฐานข้อมูล
    fetch('/news_type_combobox') // เปลี่ยนเป็นเส้นทางที่เขียนรหัสหลังบ้านของคุณเพื่อดึงข้อมูล
        .then(response => response.json())
        .then(data => {
            // สร้างตัวเลือกในกล่องคอมโบ
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.news_type_id; // แทนที่ 'id' ด้วยฟิลด์ที่ใช้เป็นค่าตัวเลือก
                option.textContent = item.news_type_name; // แทนที่ 'name' ด้วยฟิลด์ที่ใช้เป็นข้อความตัวเลือก
                dataSelect_news_type.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
</script>



<script> //ดึงข้อมูลเข้า combobox news_type
    // ในส่วนที่เรียกใช้หน้า HTML ที่มีฟอร์ม
    const dataSelect_topic = document.getElementById('news_topic_select');
    const defaultOption1 = document.createElement('option');
    defaultOption1.value = ''; // กำหนดค่าว่างให้เป็นค่าเริ่มต้น
    defaultOption1.textContent = 'กรุณาเลือก';
    dataSelect_topic.appendChild(defaultOption1);

    // ดึงข้อมูลจากฐานข้อมูล
    fetch('/news_topic_combobox') // เปลี่ยนเป็นเส้นทางที่เขียนรหัสหลังบ้านของคุณเพื่อดึงข้อมูล
        .then(response => response.json())
        .then(data => {
            // สร้างตัวเลือกในกล่องคอมโบ
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.topic_id; // แทนที่ 'id' ด้วยฟิลด์ที่ใช้เป็นค่าตัวเลือก
                option.textContent = item.topic_name; // แทนที่ 'name' ด้วยฟิลด์ที่ใช้เป็นข้อความตัวเลือก
                dataSelect_topic.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
</script>

<script> //ดึงข้อมูลเข้า combobox section
    // ในส่วนที่เรียกใช้หน้า HTML ที่มีฟอร์ม
   // Fetch section data and populate the select dropdown
   fetch('/tags')
   .then(response => response.json())
   .then(data => {
       const tagsSelect = document.getElementById('tags');
       data.forEach(tag => {
           const option = document.createElement('option');
           option.value = tag.section_id;
           option.textContent = tag.name;
           tagsSelect.appendChild(option);
       });
   })
   .catch(error => {
       console.error('Error fetching section data:', error);
   });
</script>

<!-- ส่วนของการเพิ่ม section ที่เลือกจาก combobox มาเก็บในตาราง -->
<script>
    const tagsSelect = document.getElementById('tags');
    const selectedTagsTable = document.getElementById('selectedTagsTable');
    const selectedTagsTableBody = selectedTagsTable.querySelector('tbody');

    tagsSelect.addEventListener('change', function () {
        const selectedTag = tagsSelect.options[tagsSelect.selectedIndex].text;
        const selectedId = tagsSelect.value;

        if (selectedTag) {
            const newRow = selectedTagsTableBody.insertRow();
            const idCell = newRow.insertCell();
            idCell.textContent = selectedId;
            const nameCell = newRow.insertCell();
            nameCell.textContent = selectedTag;
            const actionCell = newRow.insertCell();
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', function () {
                selectedTagsTableBody.removeChild(newRow);
            });
            actionCell.appendChild(deleteButton);
        }
    });

    // ตรงนี้คือการส่งค่าที่ถูกเลือกในตารางกลับไปในฟอร์มในตอนที่คลิกที่ปุ่ม "บันทึก"
    const form = document.getElementById('news'); // แทนค่า yourFormId ด้วย ID ของฟอร์มของคุณ
    form.addEventListener('submit', function () {
        const rows = selectedTagsTableBody.querySelectorAll('tr');
        const sectionIds = [];
        rows.forEach(row => {
            const idCell = row.querySelector('td:nth-child(1)');
            const sectionId = idCell.textContent.trim();
            sectionIds.push(sectionId);
        });
        
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'section_id';
        hiddenInput.value = JSON.stringify(sectionIds); // แปลงเป็น JSON string
        form.appendChild(hiddenInput);
    });
</script>

</html>